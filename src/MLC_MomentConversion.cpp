#include "MLC_MomentConversion.hpp"

// Internal includes
#include "MLC_MomentIndexer.hpp"

// Generated by "fluid-kinetic/codes/dsmc_wrapper/scripts/transform_calculator.nb" Mathematica script
static const double transform_array[21][21]
{
{1.3313353638003897127975349179502808533093662238181,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0.94139626377671481262603962637456780811477672126033,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0.66566768190019485639876745897514042665468311190905,0,0.94139626377671481262603962637456780811477672126033,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,1.4120943956650722189390594395618517121721650818905,0,1.1529702460077350237508062206808385195585669033226,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0.99850152285029228459815118846271063998202466786358,0,2.824188791330144437878118879123703424344330163781,0,1.6305461589167827176919332183520777253920610710379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,3.5302359891626805473476485989046292804304127047263,0,5.7648512300386751187540311034041925977928345166129,0,2.5781198461079510301315283846627734089977494320431,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{2.4962538071257307114953779711567765999550616696589,0,10.590707967488041642042945796713887841291238114179,0,12.229096191875870382689499137640582940440458032784,0,4.4654345614606262312990827033896698579952196298533,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,12.355825962069381915716770096166202481506444466542,0,30.265468957703044373458663292872011138412381212218,0,27.070258384133485816381048038959120794476369036453,0,8.3540631060224038491279768125384473499373339787665,0,0,0,0,0,0,0,0,0,0,0,0,0},
{8.7368883249400574902338228990487180998427158438063,0,49.423303848277527662867080384664809926025777866168,0,85.603673343131092678826493963484080583083206229488,0,62.516083860448767238187157847455378011933074817946,0,16.708126212044807698255953625076894699874667957533,0,0,0,0,0,0,0,0,0,0,0,0},
{0,55.601216829312218620725465432747911166779000099439,0,181.59281374621826624075197975723206683047428727331,0,243.63232545720137234742943235063208715028732132807,0,150.3731359084032692843035826256920522988720116178,0,35.443288036372760944534808185540799383572107793114,0,0,0,0,0,0,0,0,0,0,0},
{39.315997462230258706052203045719231449292221297128,0,278.00608414656109310362732716373955583389500049719,0,642.02755007348319509119870472613060437312404672116,0,703.30594343004863142960552578387300263424709170189,0,375.93283977100817321075895656423013074718002904449,0,79.253601395434532150592197078416974830895308958941,0,0,0,0,0,0,0,0,0,0},
{0,305.80669256121720241399005988011351141728450054691,0,1248.450594505250580405169860830970459459510725004,0,2233.2963166910125798514364632141274655443004455073,0,2067.6306187405449526591742611032657191094901597447,0,974.69042100025092597470722510237198304823296431063,0,185.86617050395513897334723018005451843776728571798,0,0,0,0,0,0,0,0,0},
{216.23798604226642288328711675145577297110721713421,0,1834.8401553673032144839403592806810685037070032815,0,5296.7272881062363595023893139905774860782733854495,0,7736.3653777305349457256607836226030289767180087208,0,6202.8918562216348579775227833097971573284704792341,0,2615.368846049339560969542503587760169419545195645,0,455.27727817982739727789817441562834508635926921141,0,0,0,0,0,0,0,0},
{0,1987.7435016479118156909353892207378242123492535549,0,9737.9146371409545271603249144815695837841836550311,0,21774.639087737372653551505516337742789056929343697,0,26879.198043627084384569265394342454348423372076681,0,19006.463209504893056506790889496253669440542804057,0,7248.7806496542504199605419770221262190729241430013,0,1160.733862767175242826773681816015264045797376366,0,0,0,0,0,0,0},
{1405.5469092747317487413662588844625243121969113723,0,13914.204511535382709836547724545164769486444774884,0,48200.218321766750871471742757314255123312287807591,0,88001.156171684835007629391413707109454610167349199,0,94077.193152694795345992428880198590219481802268384,0,59499.641247622475012057091956621543854294653200925,0,20715.116157182146576144366935911089701429346749119,0,3071.0131392133204720870330874791603219125162058032,0,0,0,0,0,0},
{0,14908.076262359338617682015419155533681592619401662,0,85206.753074983352112652843001713733858111606981522,0,228633.71042124241286229080792154629928509775810881,0,352789.47432260548254747160830074471332305675850644,0,332613.106166335628488868840566184439215209499071,0,190280.49205342407352396422689683081325066425875378,0,60938.527795276700248405618295340801362404362259214,0,8410.3158537094431467181903856497123056989797129871,0,0,0,0,0},
{10541.601819560488115560246941633468932341476835293,0,119264.6100988747089414561233532442694527409552133,0,482002.18321766750871471742757314255123312287807591,0,1.0560138740602180200915526969644853134553220081904e6,0,1.4111578972904219301898864332029788532922270340258e6,0,1.1899928249524495002411418391324308770858930640185e6,0,621453.48471546439728433100807733269104288040247357,0,184260.78835279922832522198524874961931475097234819,0,23787.965488314699418868323382645697652509751129246,0,0,0,0},
{0,126718.64823005437825029713106282203629353726491413,0,827722.74415698113480862761773093341462165561067764,0,2.5911820514407473457726291564441913918977745918999e6,0,4.7979368507874345626456138728901281011935719156876e6,0,5.6544228048277056843107702896251354666585614842071e6,0,4.3130244865442789998765224763281651003483898650858e6,0,2.0719099450394078084457910220415872463217483168133e6,0,571901.47805224213397683694622418043678753062048313,0,69353.241219301604936450731486942926927504519799845,0,0,0},
{89603.615466264148982262099003884485924902553099987,0,1.1404678340704894042526741795653983266418353842271e6,0,5.2675952880216520595251261727636293099048428818296e6,0,1.3464176894267779756167296886297187746555355604427e7,0,2.1590715828543455531905262428005576455371073620594e7,0,2.2758612777215596692111837673407740524267704849354e7,0,1.5847063860244342130750440705971983621593450263076e7,0,7.0479751544945704834397409357646729387892246923183e6,0,1.8197793598560745055434267387723958704169959613873e6,0,208059.72365790481480935219446082878078251355939954,0,0},
{0,1.2038271581855165933778227450968093447886040166842e6,0,8.8462868281777358782672076644993508687689443391173e6,0,3.1649437914026271151937113267996909143894246801063e7,0,6.8370600123720942517699997688684325442008399798548e7,0,9.6690629962553767201714171952589816479861401379941e7,0,9.2190898399883963622360667931514529019946833366209e7,0,5.9049433433623122540705044128185236520169827029179e7,0,2.4448788186733351227509779451083713672666934025654e7,0,5.9297021242502872220665375421336202523016364428868e6,0,641283.13698532203543203010386115822801645876595472,0},
{851234.34692950941533148994053690261628657425444987,0,1.2038271581855165933778227450968093447886040166842e7,0,6.2552694045257118206860873301568098055120009221726e7,0,1.8272811499363415383369902917117611941753696891723e8,0,3.4185300061860471258849998844342162721004199899274e8,0,4.3241364276709633715012491579474706996108639213772e8,0,3.7636776668080312560532296676683461101284444374806e8,0,2.2318587989232806530892512963254797639499211525675e8,0,8.6439519593163539013312770091688803844807308165898e7,0,1.9765673747500957406888458473778734174338788142956e7,0,2.027915337931382446780180712721424833730995299454e6}
};


// Generated by "fluid-kinetic/codes/dsmc_wrapper/scripts/transform_calculator.nb" Mathematica script
static const double inverse_transform_array[21][21]
{
{0.75112554446494248285870300477622769305236506675605,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,1.0622519320271969144770730485075135387546413127687,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{-0.53112596601359845723853652425375676937732065638433,0,1.0622519320271969144770730485075135387546413127687,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,-1.300987605876116277478546239884988269424125575234,0,0.86732507058407751831903082658999217961608371682267,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0.45996857917732664145096425876408710523330058563724,0,-1.839874316709306565803857035056348420933202342549,0,0.61329143890310218860128567835211614031106744751633,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,1.4545483623118504188855726955862434368321942805103,0,-1.9393978164158005585140969274483245824429257073471,0,0.38787956328316011170281938548966491648858514146942,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{-0.41989194426503807322513152140143376365657671610798,0,2.5193516655902284393507891284086025819394602966479,0,-1.6795677770601522929005260856057350546263068644319,0,0.22394237027468697238673681141409800728350758192426,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,-1.5710917949061518013939599615173285682029604892914,0,3.1421835898123036027879199230346571364059209785828,0,-1.2568734359249214411151679692138628545623683914331,0,0.11970223199284966105858742563941550995832079918411,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0.39277294872653795034848999037933214205074012232285,0,-3.1421835898123036027879199230346571364059209785828,0,3.1421835898123036027879199230346571364059209785828,0,-0.83791562394994762741011197947590856970824559428875,0,0.059851115996424830529293712819707754979160399592054,0,0,0,0,0,0,0,0,0,0,0,0},
{0,1.6663944930670267234908840907303556894799575720021,0,-4.443718648178737929309024241947615171946553525339,0,2.6662311889072427575854145451685691031679321152034,0,-0.50785355979185576334960277050829887679389183146732,0,0.028214086655103097963866820583794382044105101748184,0,0,0,0,0,0,0,0,0,0,0},
{-0.37261713638291737687890877087401265034970695190564,0,3.7261713638291737687890877087401265034970695190564,0,-4.9682284851055650250521169449868353379960926920751,0,1.9872913940422260100208467779947341351984370768301,0,-0.28389877057746085857440668257067630502834815383286,0,0.012617723136776038158862519225363391334593251281461,0,0,0,0,0,0,0,0,0,0},
{0,-1.7477292888707118855430822356539223334566231748282,0,5.8257642962357062851436074521797411115220772494272,0,-4.6606114369885650281148859617437928892176617995418,0,1.3316032677110185794613959890696551112050462284405,0,-0.14795591863455761994015510989662834568944958093783,0,0.0053802152230748225432783676326046671159799847613758,0,0,0,0,0,0,0,0,0},
{0.35675374718754556904139282444279818506704098746041,0,-4.2810449662505468284967138933135782208044918495249,0,7.1350749437509113808278564888559637013408197492082,0,-3.8053733033338194031081901273898473073817705329111,0,0.81543713642867558638032645586925299443895082848094,0,-0.072483301015882274344917907188378043950128962531639,0,0.0021964636671479477074217547632841831500039079555042,0,0,0,0,0,0,0,0},
{0,1.819094318456641936507251951448373896106725313347,0,-7.276377273826567746029007805793495584426901253388,0,7.276377273826567746029007805793495584426901253388,0,-2.7719532471720258080110505926832364131150100012907,0,0.46199220786200430133517509878053940218583500021511,0,-0.033599433299054858278921825365857411068060727288372,0,0.00086152393074499636612620065040660028379642890483004,0,0,0,0,0,0,0},
{-0.34377651271477201974134924079593676989438701491162,0,4.8128711780068082763788893711431147785214182087627,0,-9.6257423560136165527577787422862295570428364175254,0,6.4171615706757443685051858281908197046952242783503,0,-1.8334747344787841052871959509116627727700640795287,0,0.24446329793050454737162612678822170303600854393715,0,-0.014815957450333608931613704653831618365818699632555,0,0.00032562543846887052596953197041388172232568570620999,0,0,0,0,0,0},
{0,-1.8829415075434218715069822203994242719098504172019,0,8.7870603685359687336992503618639799355793019469424,0,-10.544472442243162480439100434236775922695162336331,0,5.0211773534491249906852859210651313917596011125385,0,-1.1158171896553611090411746491255847537243558027863,0,0.12172551159876666644085541626824560949720245121306,0,-0.0062423339281418803303002777573459286921642282673362,0,0.00011890159863127391105333862394944626080312815747307,0,0,0,0,0},
{0.3328601771403935835275292442449822121418771625609,0,-5.3257628342462973364404679079197153942700346009743,0,12.426779946574693785027758451812669253296747402273,0,-9.9414239572597550280222067614501354026373979218187,0,3.5505085561641982242936452719464769295133564006495,0,-0.63120152109585746209664804834604034302459669344881,0,0.057381956463259769281513458940549122093145153949892,0,-0.0025222838005828470013852069863977636084898968769183,0,0.000042038063343047450023086783106629393474831614615305,0,0,0,0},
{0,1.9408916806153203342473224816790799214326597516358,0,-10.351422296615041782652386568955092914307518675391,0,14.491991215261058495713341196537130080030526145547,0,-8.2811378372920334261219092551640743314460149403128,0,2.3003160659144537294783081264344650920683374834202,0,-0.33459142776937508792411754566319492248266727031567,0,0.025737802136105775994162888127938070960205174639667,0,-0.00098048770042307718073001478582621222705543522436826,0,0.000014418936770927605598970805673914885691991694476004,0,0,0},
{-0.32348194676922005570788708027984665357210995860597,0,5.8226750418459610027419674450372397642979792549074,0,-15.527133444922562673978579853432639371461278013087,0,14.491991215261058495713341196537130080030526145547,0,-6.2108533779690250695914319413730557485845112052346,0,1.3801896395486722376869848758606790552410024900521,0,-0.16729571388468754396205877283159746124133363515783,0,0.011030486629759618283212666340544887554373646274143,0,-0.0003676828876586539427737555446848295851457882091381,0,4.8063122569758685329902685579716285639972314920013e-6,0,0},
{0,-1.9940766423718451625253796769802616792815934074002,0,11.964459854231070975152278061881570075689560444401,0,-19.143135766769713560243644899010512121103296711042,0,12.762090511179809040162429932673674747402197807362,0,-4.2540301703932696800541433108912249158007326024539,0,0.77346003098059448728257151107113180287286047317343,0,-0.079329233946727639721289385750885313115165176735736,0,0.0045330990826701508412165363286220178922951529563278,0,-0.00013332644360794561297695695084182405565573979283317,0,1.5593736094496562921281514718341994813536817875225e-6,0},
{0.3152912009418028331715122581201807185451495657065,0,-6.30582401883605666343024516240361437090299131413,0,18.91747205650816999029073548721084311270897394239,0,-20.178636860275381322976784519691565986889572205216,0,10.089318430137690661488392259845782993444786102608,0,-2.6904849147033841763969046026255421315852762940288,0,0.40764922950051275399953100039780941387655701424679,0,-0.035837294901143978373585142892115113307829188065652,0,0.0017918647450571989186792571446057556653914594032826,0,-0.000046846137125678403102725676983157010859907435379937,0,4.9311723290187792739711238929638958799902563557828e-7}
};

namespace mlc {

namespace {

int
binomialCoeff(const int n,
              const int k)
{
  // From https://www.geeksforgeeks.org/binomial-coefficient-dp-9/

  // Base Cases
  if (k == 0 || k == n)
      return 1;

  // Recur
  return binomialCoeff(n - 1, k - 1) + binomialCoeff(n - 1, k);
}
}

Matrix
buildBinomialCoefficientMatrix(const unsigned int N)
{

  Matrix bc(N,N);

  // Fill binomial coefficients
  for(unsigned int n=0; n<N; ++n)
    for(unsigned int k=0; k<=n; ++k)
      bc(n,k) = binomialCoeff(n,k);

  return bc;
}

Matrix
buildTransformMatrix(const unsigned int N)
{
  if(N >= 21) throw std::logic_error("buildTransformMatrix : Requested transform matrix with "+std::to_string(N)+" coefficients. Not setup for more than 21 coefficients.");

  Matrix matrix(N,N);

  for(unsigned int i=0; i<N; ++i)
    for(unsigned int j=0; j<N; ++j)
      matrix(i,j) = transform_array[i][j];

  return matrix;

}

Matrix
buildInverseTransformMatrix(const unsigned int N)
{
  if(N >= 21) throw std::logic_error("buildInverseTransformMatrix : Requested inverse transform matrix with "+std::to_string(N)+" coefficients. Not setup for more than 21 coefficients.");

  Matrix matrix(N,N);

  for(unsigned int i=0; i<N; ++i)
    for(unsigned int j=0; j<N; ++j)
      matrix(i,j) = inverse_transform_array[i][j];

  return matrix;

}

}
